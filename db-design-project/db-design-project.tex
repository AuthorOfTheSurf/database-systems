\documentclass[11pt, a4paper]{report}

\usepackage{fullpage}
% A more tightly packed list than the standard
% \enumerate{itemize} append * after enumeration type
\usepackage{mdwlist}
% Multi-page tables + accompanying header and footer comments
\usepackage{longtable}

% Vertical table headers, not sure what does what. graphicx is
% multi-purpose and does a lot of other stuff like including images
\usepackage{array,graphicx}
\usepackage{booktabs}

% Lossless .png format expected for figures
\DeclareGraphicsExtensions{.png}

% \verbatiminput command (\begin{verbatim} is standard lib)
\usepackage{verbatim}
% Allows for verbatiminput of files AND breaks lines that are too long
% for the page to fit
\usepackage{listings}

\newcommand*\rot{\rotatebox{90}}


\title{Modeling an Online Music Business}
\author{Zane Kansil\\ Loyola Marymount University\\ Database Systems}

% Allow commands
\providecommand\phantomsection{}

% Custom ToC labeling
\renewcommand\thechapter{\Roman{chapter}}
\renewcommand\thesection{\thechapter.\arabic{section}}

% Custom ToC spacing between chapter number and
% chapter name
\usepackage{tocloft}
\setlength{\cftchapnumwidth}{3em}
\setlength{\cftsecnumwidth}{3.5em}
\setlength{\cftsubsecnumwidth}{4em}

\begin{document}

%---    Title page    ---%
\clearpage
\phantomsection
\addcontentsline{toc}{chapter}{%
    \protect\numberline{I}Title Page}
\maketitle

%---    ToC    ---%
\clearpage
\phantomsection
\addcontentsline{toc}{chapter}{%
    \protect\numberline{II}Contents}
\tableofcontents
% The title page and ToC are difficult to handle,
% we set the page and chapter counter after the
% ToC is generated so that the rest of the document
% can continue on from there.
\setcounter{page}{2}
\setcounter{chapter}{2}

%---    Description of the Enterprise    ---%
\chapter{Description of the Enterprise}
A friend of mine intends to put out an all­-purpose site for his musical career. The site will be a hub for his online business and allow him to track sales and interactions with his fans.\\

The site will serve as a place to feature embedded music and video players for John's music. It will be necessary to monitor this hosted media in terms of listens and views. Some other metrics John is interested in are on­-site plays (not a redirect), and redirects to his Soundcloud and YouTube accounts from their embedded players on his site. Videos and Songs are tracked separately due to their differing properties.\\

There is a sales aspect to the site, merchandise will also be sold under the same domain. Some
merchandise will be physical, such as hats, headbands, wristbands and stickers. Other merchandise
will be digital, such as a donation to download a mixtape (a non-album collection of John's music). Physical merchandise needs to be shipped, so appropriate data such as \texttt{shipping\_status} and \texttt{destination} will need to be tracked. With physical merchandise, quantity and availability must be tracked. Digital merchandise is easier to manage as it is transmitted and there is less customer data to collect. Digital merchandise will also be
infinitely available if listed, so there is no quantity­ related data to track.\\

JohnDB records data for Physical and Digital consumers separately.\\

As the main operator of his business, John wants to track of his sales and revenue. The most simple way to track this would be through a table of sales records. These records would detail everything necessary about the sale. A sale would correspond to a single type of product. If multiple products were purchased in the same transaction, then multiple sale entries would be logged.\\

\clearpage
\section{Ten sample Questions John would ask}
\begin{enumerate}
    \item How many video plays today?
    \item How many redirects to Soundcloud from embedded music players?
    \item What is the redirect rate for videos?
    \item Is ``Black Silk Hooded Sweatshirt'' sold out?
    \item How many ``Red Summer Beanie'' items were sold in October 2014?
    \item What digital goods are currently unavailable?
    \item How many orders do I have to fill to the US?
    \item What precentage of my digital consumers are from outside the US?
    \item How many digital consumers are also physical consumers?
    \item What products have garnered zero sales in the past 14 days? 
\end{enumerate}

%---    Definition of Environment    ---%
\chapter{Definition of Environment}

\section{Input and Report forms}

% Number forms
\begin{enumerate}
\item Video Metadata View
    % itemize* is a more compacted list, imported by mdwlist
  \begin{itemize*}
    \item Video Name
    \item Video (hosted at) URL
    \item Number of plays
    \item Total plays
    \item Plays Today
    \item Total redirects to YouTube
  \end{itemize*}

\item Song Metadata View
  \begin{itemize*}
    \item Song Name
    \item Song Artist
    \item Song (hosted at) URL
    \item Total plays
    \item Plays Today
    \item Total redirects to SoundCloud
  \end{itemize*}

\item Add New Physical good
  \begin{itemize*}
    \item Name
    \item Description Paragraph
    \item Color (optional)
    \item Size (optional)
    \item Price (in USD)
    \item Current stock on hand
  \end{itemize*}

\item Add New Digital good
  \begin{itemize*}
    \item Name
    \item Description Paragraph
    \item Price (in USD)
  \end{itemize*}

\item Physical Good Admin View
  \begin{itemize*}
    \item Name
    \item Good SKU
    \item Good description (editable)
    \item Price (in USD)
    \item Color of Good (editable)
    \item Quantity
    \item Size of Good
  \end{itemize*}

\item Digital Good Admin View
  \begin{itemize*}
    \item Name
    \item Good SKU
    \item Good description (editable)
    \item Price (in USD)
    \item Available (togglable)
  \end{itemize*}

\item Physical Consumer Admin View
  \begin{itemize*}
    \item Customer id
    \item First Name (editable)
    \item Last Name (editable)
    \item Customer Phone Number (editable)
    \item Address Line 1 (editable)
    \item Address Line 2 (editable)
    \item Customer Country (fixed to `US')
    \item Customer State (US states including `HI' and `AL')
    \item Customer Zip Code (editable)
  \end{itemize*}

\item Digital Consumer Admin View
  \begin{itemize*}
    \item Customer id
    \item First Name (editable)
    \item Last Name (editable)
    \item Customer Phone Number (editable)
    \item Customer Country (editable)
  \end{itemize*}

\item Transaction Log
  \begin{itemize*}
    \item Item SKU
    \item Sale type (\texttt{digital} or \texttt{physical}, derived)
    \item Status (\texttt{received}, \texttt{shipped} or \texttt{fulfilled})
    \item Availability of Good
    \item Quantity (of each line item)
    \item Unit Price (of each line item)
    \item Line number (each line item is numbered sequentially)
    \item Total Order Cost (derived)
    \item Sale date (time that purchase was made)
  \end{itemize*}

\item Interaction Log
  \begin{itemize*}
    \item Interaction timestamp
    \item Media identifier (interaction was made against this Song or Video)
    \item Title of Media
  \end{itemize*}
 
\end{enumerate}

\clearpage
\section{Assumptions}
\begin{enumerate}
\item Forms are used to add items to the site
\item Tables as opposed to graphs are the prefered way to view data
\item The Sales table functions as an Orders table as well, showing the status of each order in addition to transaction information
\item Only customers in the ‘US’ are allowed to order physical goods
\end{enumerate}

\clearpage
\section{User-oriented data dictionary}

% `p{<width>}` instread of `l` allows for multi-line text within a cell
% because it fixes the width of the cell rather than stretching to the longest element
\begin{longtable}{|l|p{10cm}|}

\hline
\textbf{Datum}          & \textbf{Information Definition} \\

c\_email                & Email address                                                                                                                                                         \\ \hline
c\_first\_name          & First name of customer                                                                                                                                                \\ \hline
c\_id                   & Identifies a customer                                                                                                                                                 \\ \hline
c\_last\_name           & Last name of customer                                                                                                                                                 \\ \hline
c\_phone                & Phone number. All digits, no dashes or spaces.                                                                                                                        \\ \hline
dc\_country             & Country which customer resides. Optional and may be any country.                                                                                                      \\ \hline
dc\_id                  & Alias of `c\_id', used specifically to identify a digital consumer                                                                                                     \\ \hline
dg\_id                  & Alias of `g\_id', used specifically to identify a digital good                                                                                                         \\ \hline
dg\_is\_available       & Reflects whether or not this good is available for purchase. Set to ``false'' to prevent customers from soliciting a copy                                               \\ \hline
g\_description          & Description of good                                                                                                                                                   \\ \hline
g\_name                 & Name of physical good                                                                                                                                                 \\ \hline
g\_price                & Price of good in USD pennies                                                                                                                                          \\ \hline
g\_sku                  & Uniquely identifies a class of item for sale. For physical goods this is specific for each color color size.                                                          \\ \hline
i\_date                 & Datetime this interaction was logged                                                                                                                                  \\ \hline
i\_id                   & Interaction identifier.                                                                                                                                               \\ \hline
li\_number              & Identifies the particular line item amongst a list of line items. Line items in a purchase are numbered sequentially in this manner                                   \\ \hline
li\_quantity            & Number of units sold in the line item. A series of line items composes a purchase.                                                                                    \\ \hline
m\_id                   & Media identifier. Identifies a Song or Video hosted on the site.                                                                                                      \\ \hline
m\_upload\_date         & Date/time that the video was uploaded                                                                                                                              \\ \hline
mv\_plays               & Total plays originating at the site. This is derived from the log of PLAY entries pointing to this song.                                                              \\ \hline
mv\_plays\_today        & Plays originating at the site today. This is derived from the log of PLAY entries pointing to this song.                                                              \\ \hline
mv\_redirects           & Number of redirects to YouTube (which occurs when the embedded video is clicked by a viewer). This is derived from the log of REDIRECT entries pointing to this song. \\ \hline
mv\_title               & Music video’s title, identical to it’s title on Youtube                                                                                                               \\ \hline
mv\_url                 & YouTube URL that the video is hosted at                                                                                                                               \\ \hline
pc\_address\_line\_1    & Address of customer                                                                                                                                                   \\ \hline
pc\_address\_line\_2    & Second line of customer address                                                                                                                                       \\ \hline
pc\_country             & Country which customer resides. This will always be ``US''                                                                                                              \\ \hline
pc\_id                  & Alias of `c\_id', used specifically to identify a physical consumer                                                                                                    \\ \hline
pc\_state               & State which customer resides                                                                                                                                          \\ \hline
pc\_zip\_code           & Zip code. 5 digits in the US.                                                                                                                                         \\ \hline
pg\_color               & Color of good                                                                                                                                                         \\ \hline
pg\_id                  & Alias of `g\_id', used specifically to identify a physical good                                                                                                        \\ \hline
pg\_quantity\_available & Current quantity available. This is an editable field so users should take care not to set the field inappropriately.                                                 \\ \hline
pg\_size                & Size of good, either `S', `M',`L', ..., or a numbered size, or `OSFA' (one size fits all)                                                                             \\ \hline
pl\_id                  & Alias of `i\_id', used specifically to identify a play                                                                                                                  \\ \hline
re\_id                  & Alias of `i\_id', used specifically to identify a redirect                                                                                                             \\ \hline
re\_url                 & The non-local url that the redirect sent the user to. Music videos redirect to a Soundcloud uri, Videos redirect to a Youtube uri.                                    \\ \hline
sale\_date              & Datetime this sale was logged                                                                                                                                         \\ \hline
sale\_fulfill\_date     & Date this sale was set to `fulfilled'                                                                                                                                 \\ \hline
sale\_id                & Sales/transaction identifier                                                                                                                                          \\ \hline
sale\_status            & The shipping status, `received', `shipped' or `fulfilled'                                                                                                             \\ \hline
so\_artist              & Artist of song, including features                                                                                                                                    \\ \hline
so\_plays               & Total plays originating at the site. This is derived from the log of PLAY entries pointing to this song.                                                              \\ \hline
so\_plays\_today        & Plays on the site today. This is derived from the log of PLAY entries pointing to this song.                                                                          \\ \hline
so\_redirects           & Redirects to SoundCloud (triggered by clicks on the embedded player). This is derived from the log of REDIRECT entries pointing to this song.                         \\ \hline
so\_title               & Title of song                                                                                                                                                         \\ \hline
so\_url                 & SoundCloud URL that the video is hosted at                                                                                                                            \\ \hline

\end{longtable}


\clearpage
\section{Cross-reference table}

\begin{longtable}{|l|l|l|l|l|l|l|l|l|l|l|}

\hline
\multicolumn{1}{|c|}{Datum} &
\multicolumn{10}{c|}{Form or Screen} \\[1ex]

\hline
&   % empty label block
\rot{Video Metadata View} &
\rot{Song Metadata View} &
\rot{Add New Physical good} &
\rot{Add New Digital good} &
\rot{Physical Good Admin} &
\rot{Digital Good Admin} &
\rot{Physical Consumer Admin View} &
\rot{Digital Consumer Admin View} &
\rot{Transaction Log} &
\rot{Interaction Log} \\
\hline

c\_email                &   &   &   &   &   &   & x & x &   &   \\ \hline
c\_first\_name          &   &   &   &   &   &   & x & x &   &   \\ \hline
c\_id                   &   &   &   &   &   &   &   &   &   &   \\ \hline
c\_last\_name           &   &   &   &   &   &   & x & x &   &   \\ \hline
c\_phone                &   &   &   &   &   &   & x & x &   &   \\ \hline
dc\_country             &   &   &   &   &   &   &   & x &   &   \\ \hline
dc\_id                  &   &   &   &   &   &   &   & x &   &   \\ \hline
dg\_id                  &   &   &   &   &   & x &   &   &   &   \\ \hline
dg\_is\_available       &   &   &   & x &   & x &   &   & x &   \\ \hline
g\_description          &   &   & x & x & x & x &   &   &   &   \\ \hline
g\_name                 &   &   & x & x & x & x &   &   & x &   \\ \hline
g\_price                &   &   & x & x & x & x &   &   & x &   \\ \hline
g\_sku                  &   &   &   &   &   &   &   &   & x &   \\ \hline
i\_date                 &   &   &   &   &   &   &   &   &   & x \\ \hline
i\_id                   &   &   &   &   &   &   &   &   &   & x \\ \hline
li\_quantity            &   &   &   &   &   &   &   &   & x &   \\ \hline
m\_id                   &   &   &   &   &   &   &   &   &   & x \\ \hline
m\_upload\_date         &   & x &   &   &   &   &   &   &   &   \\ \hline
mv\_plays               & x &   &   &   &   &   &   &   &   &   \\ \hline
mv\_plays\_today        & x &   &   &   &   &   &   &   &   &   \\ \hline
mv\_redirects           & x &   &   &   &   &   &   &   &   &   \\ \hline
mv\_title               & x &   &   &   &   &   &   &   &   & x \\ \hline
mv\_url                 & x &   &   &   &   &   &   &   &   &   \\ \hline
pc\_address\_line\_1    &   &   &   &   &   &   & x &   &   &   \\ \hline
pc\_address\_line\_2    &   &   &   &   &   &   & x &   &   &   \\ \hline
pc\_country             &   &   &   &   &   &   & x &   &   &   \\ \hline
pc\_id                  &   &   &   &   &   &   & x &   &   &   \\ \hline
pc\_state               &   &   &   &   &   &   & x &   &   &   \\ \hline
pc\_zip\_code           &   &   &   &   &   &   & x &   &   &   \\ \hline
pg\_color               &   &   & x &   & x &   &   &   & x &   \\ \hline
pg\_id                  &   &   &   &   & x &   &   &   &   &   \\ \hline
pg\_quantity\_available &   &   & x &   & x &   &   &   &   &   \\ \hline
pg\_size                &   &   & x &   & x &   &   &   & x &   \\ \hline
re\_url                 &   &   &   &   &   &   &   &   &   &   \\ \hline
sale\_date              &   &   &   &   &   &   &   &   & x &   \\ \hline
sale\_fulfill\_date     &   &   &   &   &   &   &   &   & x &   \\ \hline
sale\_id                &   &   &   &   &   &   &   &   & x &   \\ \hline
sale\_status            &   &   &   &   &   &   &   &   & x &   \\ \hline
so\_artist              &   & x &   &   &   &   &   &   &   &   \\ \hline
so\_plays               &   & x &   &   &   &   &   &   &   &   \\ \hline
so\_plays\_today        &   & x &   &   &   &   &   &   &   &   \\ \hline
so\_redirects           &   & x &   &   &   &   &   &   &   &   \\ \hline
so\_title               &   & x &   &   &   &   &   &   &   & x \\ \hline
so\_url                 &   & x &   &   &   &   &   &   &   &   \\ \hline

\end{longtable}

%---    Enterprise Database Design    ---%
\chapter{Enterprise Database Design}

\section{Logical model of the Enterprise}

\subsection{List of Entities and Attributes}

\begin{enumerate}

\item Media
  \begin{itemize*}
    \item m\_id
  \end{itemize*}

\item Music Video
  \begin{itemize*}
    \item mv\_id (alias of m\_id)
    \item mv\_title
    \item mv\_url (url video is hosted at)
    \item mv\_upload\_date
  \end{itemize*}

\item Song
  \begin{itemize*}
    \item so\_id (alias of m\_id)
    \item so\_title
    \item so\_artist
    \item so\_url (url song is hosted at)
    \item so\_upload\_date
  \end{itemize*}

\item Interaction
  \begin{itemize*}
  \item i\_id
  \item i\_date
  \end{itemize*}

\item Play
  \begin{itemize*}
  \item pl\_id (alias of i\_id)
  \end{itemize*}

\item Redirect
  \begin{itemize*}
    \item re\_id (alias of i\_id)
    \item re\_url
  \end{itemize*}

\item Consumer
  \begin{itemize*}
    \item c\_id
    \item c\_firstname
    \item c\_lastname
    \item c\_email
    \item c\_phone
  \end{itemize*}

\item Physical Consumer
  \begin{itemize*}
    \item pc\_id (alias of c\_id)
    \item pc\_address\_line\_1
    \item pc\_address\_line\_2
    \item pc\_country
    \item pc\_state
  \end{itemize*}

\item Digital Consumer
  \begin{itemize*}
    \item dc\_id (alias of c\_id)
    \item dc\_country (optional)
  \end{itemize*}

\item Purchase
  \begin{itemize*}
    \item sale\_id
    \item sale\_status (``received'', ``shipped'' or ``fulfilled'')
    \item sale\_date (datetime)
    \item sale\_fulfill\_date (datetime)
  \end{itemize*}

\item Line Item
  \begin{itemize*}
    \item li\_quantity
  \end{itemize*}

\item Good
  \begin{itemize*}
    \item g\_sku
    \item g\_name
    \item g\_description
    \item g\_price
  \end{itemize*}

\item Digital Good
  \begin{itemize*}
    \item dg\_id (alias g\_sku)
    \item dg\_is\_available (boolean, used to prevent ordering)
  \end{itemize*}

\item Physical Good
  \begin{itemize*}
    \item pg\_id (alias g\_sku)
    \item pg\_color
    \item pg\_size
    \item pg\_quantity\_available
  \end{itemize*}

\end{enumerate}

* - A datetime is an instant in time. Has date information and time-of-day information. Example: 2014-09-06T15:35:58+00:00 (September 6, 2014, 3:35:58pm)

\clearpage
\subsection{List of Relationships and Attributes}

\noindent\textbf{Media Relationships}
\begin{enumerate}
\item INTERACTION(i\_id, m\_id)
\end{enumerate}

\noindent\textbf{Sales Relationships}
\begin{enumerate}
\item CUSTOMER\_PURCHASE(c\_id, sale\_id)
\item LINE\_ITEM(sale\_id, g\_sku)
\end{enumerate}

\clearpage
\subsection{Entity-Relationship diagram of the Enterprise}
\includegraphics[width=\textwidth]{ERB.png}

\clearpage
\section{Conceptual model of the enterprise}

\begin{verbatim}
MEDIA(m_id, m_upload_date)

MUSIC_VIDEO(mv_id, mv_title, mv_url)
    PK/FK: mv_id
    CK:    mv_id, mv_title, mv_url

SONG(so_id, so_title, so_artist, so_url)
    PK/FK: so_id
    CK:    so_id, so_title, so_url

PLAY(pl_id, m_id, i_datetime)
    PK: pl_id
    FK: m_id
    CK: pl_id

REDIRECT(m_id, m_to)
    PK: re_id
    FK: m_id
    CK: re_id

CONSUMER(c_id, c_firstname, c_lastname, c_email)
    PK: c_id
    CK: c_id, c_email

PHYSICAL_CONSUMER(
  pc_id
, pc_address_line_1
, pc_address_line_2
, pc_country
, pc_state
, pc_phone
)
    PK/FK: pc_id
    CK: pc_id, pc_phone

DIGITAL_CONSUMER(
  dc_id
, pc_phone
, pc_country
)
    PK/FK: dc_id
    CK:    dc_id, pc_phone

PURCHASE(sale_id, c_id, sale_date, sale_fulfill_date)
    PK/FK: sale_id
    CK:    sale_id, c_id

LINE_ITEM(sale_id, g_id, li_quantity)
    PK: sale_id
    CK: sale_id
    FK: sale_id, g_id

GOOD(g_sku, g_name, g_description, g_price)
    PK: g_sku
    CK: g_sku

DIGITAL_GOOD(dg_id, dg_is_available)
    PK: dg_id
    CK: dg_id

PHYSICAL_GOOD(pg_id, pg_color, pg_size, pg_quantity_available)
    PK/FK: pg_id
    CK:    pg_id
\end{verbatim}

\clearpage
\section{Table dictionary}

% `p{<width>}` instread of `l` allows for multi-line text within a cell
% because it fixes the width of the cell rather than stretching to the longest element
\begin{longtable}{|l|p{4cm}|p{7cm}|}
\hline
\textbf{Table}      & \textbf{Attributes}                                                          & \textbf{Description}                                   \\ \hline
CUSTOMER            & c\_id, c\_firstname, c\_lastname, c\_email, c\_phone                         & Basic customer information                             \\ \hline
DIGITAL\_CONSUMER   & dc\_id, dc\_country                                                          & Customer information specific to digital customers     \\ \hline
DIGITAL\_GOOD       & dg\_id, dg\_is\_available                                                    & Good information specific to digital goods             \\ \hline
GOOD                & g\_sku, g\_name, g\_description, g\_price                                    & Basic information for goods that are being sold        \\ \hline
INTERACTION         & i\_id, m\_id, i\_date                                                        & A list of all of the interactions made on media items  \\ \hline
LINE\_ITEM          & sale\_id, g\_sku, li\_quantity                                               & An item that was sold in a transaction                 \\ \hline
MEDIA               & m\_id, m\_upload\_date                                                       & Basic information for songs and videos on the page     \\ \hline
MUSIC\_VIDEO        & mv\_id, mv\_title, mv\_url                                                   & Additional media information specific to Music Videos  \\ \hline
PHYSICAL\_CONSUMER  & pc\_id, pc\_address\_line\_1, pc\_address\_line\_2, pc\_country, pc\_state   & Customer information specific to physical customers    \\ \hline
PHYSICAL\_GOOD      & pg\_id, pg\_color, pg\_size, pg\_quantity\_available                         & Good information specific to physical goods            \\ \hline
PLAY                & pl\_id                                                                       & A table of all the play interactions                   \\ \hline
PURCHASE            & sale\_id, sale\_status, sale\_fulfill\_date, sale\_date, c\_id               & Information specific to a single sale                  \\ \hline
REDIRECT            & re\_id, re\_url                                                              & A table of all the redirect interactions               \\ \hline 
SONG                & so\_id, so\_title, so\_artist, so\_url                                       & Additional media information specific to Songs         \\ \hline
\end{longtable}

\clearpage
\section{Attribute dictionary}

% `p{<width>}` instread of `l` allows for multi-line text within a cell
% because it fixes the width of the cell rather than stretching to the longest element
\begin{longtable}{|l|p{4.4cm}|p{7cm}|}

\hline
\textbf{Datum}          & \textbf{Appears in}    & \textbf{Information Definition} \\
c\_email                & CUSTOMER               & Email address                                                                                                                                                         \\ \hline
c\_first\_name          & CUSTOMER               & First name of customer                                                                                                                                                \\ \hline
c\_id                   & CUSTOMER, PURCHASE     & Identifies a customer                                                                                                                                                 \\ \hline
c\_last\_name           & CUSTOMER               & Last name of customer                                                                                                                                                 \\ \hline
c\_phone                & CUSTOMER               & Phone number. All digits, no dashes or spaces.                                                                                                                        \\ \hline
dc\_country             & DIGITAL\_CUSTOMER       & Country which customer resides. Optional and may be any country.                                                                                                      \\ \hline
dc\_id                  & DIGITAL\_CUSTOMER       & Alias of `c\_id', used specifically to identify a digital consumer                                                                                                    \\ \hline
dg\_id                  & DIGITAL\_GOOD           & Alias of `g\_id', used specifically to identify a digital good                                                                                                        \\ \hline
dg\_is\_available       & DIGITAL\_GOOD           & Reflects whether or not this good is available for purchase. Set to ``false'' to prevent customers from soliciting a copy                                             \\ \hline
g\_description          & GOOD                   & Description of good                                                                                                                                                   \\ \hline
g\_name                 & GOOD                   & Name of physical good                                                                                                                                                 \\ \hline
g\_price                & GOOD                   & Price of good in USD pennies                                                                                                                                          \\ \hline
g\_sku                  & GOOD, LINE\_ITEM        & Uniquely identifies a class of item for sale. For physical goods this is specific for each color color size.                                                          \\ \hline
i\_date                 & INTERACTION            & Datetime this interaction was logged                                                                                                                                  \\ \hline
i\_id                   & INTERACTION            & Interaction identifier.                                                                                                                                               \\ \hline
li\_quantity            & LINE\_ITEM              & Number of units sold in the line item. A series of line items composes a purchase.                                                                                    \\ \hline
m\_id                   & MEDIA, INTERACTION     & Media identifier. Identifies a Song or Video hosted on the site.                                                                                                      \\ \hline
m\_upload\_date         & MEDIA                  & Date/time that the video was uploaded                                                                                                                                 \\ \hline
mv\_plays               & MUSIC\_VIDEO            & Total plays originating at the site. This is derived from the log of PLAY entries pointing to this song.                                                              \\ \hline
mv\_plays\_today        & MUSIC\_VIDEO            & Plays originating at the site today. This is derived from the log of PLAY entries pointing to this song.                                                              \\ \hline
mv\_redirects           & MUSIC\_VIDEO            & Number of redirects to YouTube (which occurs when the embedded video is clicked by a viewer). This is derived from the log of REDIRECT entries pointing to this song. \\ \hline
mv\_title               & MUSIC\_VIDEO            & Music video’s title, identical to it’s title on Youtube                                                                                                               \\ \hline
mv\_url                 & MUSIC\_VIDEO            & YouTube URL that the video is hosted at                                                                                                                               \\ \hline
pc\_address\_line\_1    & PHYSICAL\_CONSUMER      & Address of customer                                                                                                                                                   \\ \hline
pc\_address\_line\_2    & PHYSICAL\_CONSUMER      & Second line of customer address                                                                                                                                       \\ \hline
pc\_country             & PHYSICAL\_CONSUMER      & Country which customer resides. This will always be ``US''                                                                                                            \\ \hline
pc\_id                  & PHYSICAL\_CONSUMER      & Alias of `c\_id', used specifically to identify a physical consumer                                                                                                   \\ \hline
pc\_state               & PHYSICAL\_CONSUMER      & State which customer resides                                                                                                                                          \\ \hline
pc\_zip\_code           & PHYSICAL\_CONSUMER      & Zip code. 5 digits in the US.                                                                                                                                         \\ \hline
pg\_color               & PHYSICAL\_GOOD          & Color of good                                                                                                                                                         \\ \hline
pg\_id                  & PHYSICAL\_GOOD          & Alias of `g\_id', used specifically to identify a physical good                                                                                                       \\ \hline
pg\_quantity\_available & PHYSICAL\_GOOD          & Current quantity available. This is an editable field so users should take care not to set the field inappropriately.                                                 \\ \hline
pg\_size                & PHYSICAL\_GOOD          & Size of good, either `S', `M',`L', ..., or a numbered size, or `OSFA' (one size fits all)                                                                             \\ \hline
pl\_id                  & PLAY                   & Alias of `i\_id', used specifically to identify a play                                                                                                                 \\ \hline
re\_id                  & REDIRECT               & Alias of `i\_id', used specifically to identify a redirect                                                                                                             \\ \hline
re\_url                 & REDIRECT               & The non-local url that the redirect sent the user to. Music videos redirect to a Soundcloud uri, Videos redirect to a Youtube uri.                                    \\ \hline
sale\_date              & PURCHASE               & Datetime this sale was logged                                                                                                                                         \\ \hline
sale\_fulfill\_date     & PURCHASE               & Date this sale was set to `fulfilled'                                                                                                                                 \\ \hline
sale\_id                & PURCHASE, LINE\_ITEM    & Sales/transaction identifier                                                                                                                                          \\ \hline
sale\_status            & PURCHASE               & The shipping status, `received', `shipped' or `fulfilled'                                                                                                             \\ \hline
so\_artist              & SONG                   & Artist of song, including features                                                                                                                                    \\ \hline
so\_plays               & SONG                   & Total plays originating at the site. This is derived from the log of PLAY entries pointing to this song.                                                              \\ \hline
so\_plays\_today        & SONG                   & Plays on the site today. This is derived from the log of PLAY entries pointing to this song.                                                                          \\ \hline
so\_redirects           & SONG                   & Redirects to SoundCloud (triggered by clicks on the embedded player). This is derived from the log of REDIRECT entries pointing to this song.                         \\ \hline
so\_title               & SONG                   & Title of song                                                                                                                                                         \\ \hline
so\_url                 & SONG                   & SoundCloud URL that the video is hosted at                                                                                                                            \\ \hline
\end{longtable}

%---    Database and Query Definition    ---%
\chapter{Database and Query Definition}

\section{Database Definition}
    \verbatiminput{sql/online-music-business.sql}

\clearpage
\section{Database Queries}
    \verbatiminput{sql/db-queries-10-questions.sql}

\clearpage
\section{Design Tradeoffs and Limitations}
Music videos and songs have some duplicate fields that could be added to the parent Media table. This was done to allow individual constraints to be placed upon those fields. For example there is both an `so\_url' and a `mv\_url', the separation here would allow for specific constraints to be placed, like checking that ``youtube'' is somewhere in the link of a video.

%---    Database Integrity and Security    ---%
\chapter{Database Integrity and Security}

\section{Functional Dependencies}

\noindent\textbf{Media Dependencies}
\begin{enumerate}
\item \texttt{m\_id} $\longrightarrow$ \texttt{m\_upload\_date, so\_id, mv\_id}
\item \texttt{so\_id} $\longrightarrow$ \texttt{so\_title, so\_artist, so\_url, m\_id}
\item \texttt{mv\_id} $\longrightarrow$ \texttt{mv\_title, mv\_url, m\_id}
\item \texttt{i\_id} $\longrightarrow$ \texttt{i\_date, m\_id, re\_id, pl\_id}
\item \texttt{re\_id} $\longrightarrow$ \texttt{re\_url, i\_id}
\item \texttt{pl\_id} $\longrightarrow$ \texttt{i\_id}
\end{enumerate}

\noindent\textbf{Sales Dependencies}
\begin{enumerate}
\item \texttt{c\_id} $\longrightarrow$ \texttt{c\_firstname, c\_lastname, c\_email, c\_phone, dc\_id, pc\_id}
\item \texttt{dc\_id} $\longrightarrow$ \texttt{dc\_country, c\_id}
\item \texttt{pc\_id} $\longrightarrow$ \texttt{pc\_address\_line\_1, pc\_address\_line\_2, pc\_country, pc\_state, c\_id}
\item \texttt{sale\_id} $\longrightarrow$ \texttt{sale\_status, sale\_date, sale\_fulfill\_date}
\item \texttt{g\_sku} $\longrightarrow$ \texttt{g\_name, g\_description, g\_price, pg\_id, dg\_id}
\item \texttt{pg\_id} $\longrightarrow$ \texttt{pg\_color, pg\_size, pg\_quantity\_available, g\_sku}
\item \texttt{dg\_id} $\longrightarrow$ \texttt{dg\_is\_available, g\_sku}
\item \texttt{(sale\_id, g\_sku)} $\longrightarrow$ \texttt{li\_quantity}
\end{enumerate}

\clearpage
\section{Adjustments for Normalization}
John's database has already been presented in third normal form. No further normalization is necessary.

\clearpage
\section{Integrity and Security}
\begin{itemize*}
    \item All identifiers must should be generated by the dbms
    \item All date fields should be generated in a consistent manner across all records
    \item A valid email regex should be used to ensure that supplied email addresses are at least syntactically valid
    \item \textbf{sale\_status} must be one of ``received'', ``shipped'' or ``fulfilled''
    \item \textbf{sale\_date} should be prior to \textbf{sale\_fulfill\_date}
    \item \textbf{li\_quantity} should be non-negative
    \item \textbf{g\_price} should be non-negative
    \item \textbf{pc\_state} should be a standard US 2-character state code
    \item \textbf{i\_date} should be prior to \textbf{m\_upload\_date}
    \item \textbf{mv\_url, so\_url, re\_url} should be verified by a regex to ensure that they are valid urls
  \end{itemize*}


%---    Implementation Notes    ---%
\chapter{Implementation Notes}

\section{Indices}
An index should be placed on \textbf{c\_id} as it is the primary index of customers. Having this as a primary, physical index will improve search times for a customer by id. This will reduce the operation time of join operations, such as the join to figure out which purchase belongs to a specific customer.

A primary index should be placed on \textbf{sale\_id} and \textbf{g\_sku} as physical indexes here will improve search times for individual elements. This will also make the joins between Purchase and Good through Line\_Item quicker.

No further indexes will be placed. The main information that John wants to see is available through joining tables together. Since physical indexes have already been placed on the join-on properties, these tables have been indexed as effectively as necessary.

\clearpage
\section{Data}
    \lstinputlisting[breaklines]{sql/music-store-data.sql}

\clearpage
\section{Query Trace}
A bug was occuring for me in phpMyAdmin. To do the query trace a separate window is opened up, when I attempt to load in the files there phpMyAdmin ALWAYS loses my login token. As a result I cannot see or generate a query trace. The history view cannot be accessed outside of the popup menu. I have tried several browsers, operating systems and orders of doing this process, to no avail.

\clearpage
\section{Implementation Assessment}
The order that I went about things really helped my implementation. After several iterations of improving the design of my database I had my ERB/tables all set and correct. This was essential in being able to generate data that would reveal the success of my queries. When writing data and queries it is important that all the naming and conventions be out of the way.

Having a solid ERB is probably the most important aspect of implementation. It is the best point of reference for doing mock data, queries as well as the generation of the database which I used Ebarcadero Studio for, which I found to be essential. Using tools was important for minimizing mistakes, the SQL compiler alerted me to any other issues that were missed.

The most difficult part of implementation was trying to get the query trace to work. I didn't know how to do it initially, and with internet help it seems that there is a bug in phpMyAdmin that prevented me from gathering the trace data for that section.

%---    Lessons Learned    ---%
\chapter{Lessons Learned}

\end{document}
